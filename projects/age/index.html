<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>AGE Game Engine | Thaqib M</title> <meta name="author" content="Thaqib M"> <meta name="description" content="An Entity Component System based game engine written in C++17"> <meta name="keywords" content="thaqib"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%EF%AC%A6&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://thaqibm.github.io/projects/age/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Thaqib </span>M</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">AGE Game Engine</h1> <p class="post-description">An Entity Component System based game engine written in C++17</p> </header> <article> <h1 id="game-engine-overview">Game Engine Overview</h1> <p>The game executes the update method each cycle and these are the following things that happen:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Update cycle:
* - Detect Collisions (Collision System)
* - Get input (Controller)
* - Pass collision data to all systems (system_base)
* -Pass input to all systems (system_base)
* - Call update on each system
* - Render (Render System)
**/</span>
</code></pre></div></div> <h2 id="entity">Entity</h2> <p>An entity is just a index of a game object. Each EntityID is just a unique 32 bit integer. The maximum number of entities that the game can have must be determined at <em>compile time</em>.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="n">EntityID</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">MAX_ENTT</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span>
</code></pre></div></div> <h2 id="component">Component</h2> <p>A Component is any piece of pure data. A user can attach any component to an entity and its behavior will change based on the data added. For example the some physics based components are:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Components/default/default.h</span>
<span class="k">struct</span> <span class="nc">Vec2d</span><span class="p">{</span> <span class="kt">float</span> <span class="n">x</span><span class="p">;</span> <span class="kt">float</span> <span class="n">y</span><span class="p">;</span> <span class="p">};</span>
<span class="k">struct</span> <span class="nc">Position</span><span class="p">{</span>
<span class="n">Vec2d</span> <span class="n">p</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">z</span><span class="p">;</span> <span class="c1">// height</span>
<span class="kt">float</span> <span class="n">len</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">width</span><span class="p">;</span> <span class="p">};</span>
<span class="k">struct</span> <span class="nc">Velocity</span><span class="p">{</span> <span class="n">Vec2d</span> <span class="n">v</span><span class="p">;</span> <span class="p">};</span>
<span class="k">struct</span> <span class="nc">Acceleration</span><span class="p">{</span> <span class="n">Vec2d</span> <span class="n">a</span><span class="p">;</span> <span class="p">};</span>
</code></pre></div></div> <p>These are just pure pieces of POD data the user can attach to any entity and their behavior / movement will change based on that. Attaching / Detaching components to an entity is done with templates and to make it easier to save predefined data I’ve created a prefab template class.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="nf">attachComponent</span><span class="p">(</span><span class="n">EntityID</span> <span class="n">id</span><span class="p">,</span> <span class="n">T</span> <span class="n">component</span><span class="p">)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="n">detachComponent</span><span class="p">(</span><span class="n">EntityID</span> <span class="n">id</span><span class="p">)</span>
<span class="c1">// Examples:</span>
<span class="n">GAME1</span><span class="p">.</span><span class="n">attachComponent</span><span class="o">&lt;</span><span class="n">PlayerTag</span><span class="o">&gt;</span><span class="p">(</span><span class="n">player</span> <span class="p">{</span><span class="n">GAME1</span><span class="p">.</span><span class="n">createEntityFromPrefab</span><span class="p">(</span><span class="n">bullet</span><span class="p">),</span> <span class="mi">0</span><span class="p">});</span>
<span class="n">GAME1</span><span class="p">.</span><span class="n">attachComponent</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Velocity</span><span class="o">&gt;</span><span class="p">(</span><span class="n">er</span><span class="p">,</span> <span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}});</span>
<span class="n">GAME1</span><span class="p">.</span><span class="n">attachComponent</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Solid_tag</span><span class="o">&gt;</span><span class="p">(</span><span class="n">er</span><span class="p">,</span> <span class="p">{});</span>
</code></pre></div></div> <h3 id="prefabs">Prefabs</h3> <p>This is a feature to make it easier to add stored entities with predefined data. So the user does not need to type out attach every time. For example the bullet prefab in the example above is defined as:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Prefab.h</span>
<span class="n">Prefab</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Position</span><span class="p">,</span> <span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Drawable</span><span class="p">,</span> <span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Velocity</span><span class="p">,</span> <span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">acceleration</span><span class="p">,</span> 
    <span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">BoxCollider</span><span class="p">,</span> <span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Mass</span><span class="o">&gt;</span> <span class="n">bullet</span><span class="p">(</span>
            <span class="s">"bullet"</span><span class="p">,</span>
            <span class="p">{{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span>
            <span class="p">{{{</span><span class="err">’</span><span class="n">o</span><span class="err">’</span><span class="p">}}},</span>
            <span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span>
            <span class="p">{{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span>
            <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="mf">1.0</span><span class="n">f</span><span class="p">}</span>
            <span class="p">);</span>
</code></pre></div></div> <h2 id="system">System</h2> <p>A System is the core logic and it handles mutating game state / movement of entities and the core game logic. Any system the user defines must have an update method and they can decide if they need an end() method which is called for each system at the end of the game. To enforce this on user defined systems the inheritance was the best strategy. Any system must be derived from system base class. It also provides interfaces the user can access to get the current Input, Collision data for their system to react. A system can only run and modify entities that have a specified signature. That is they must have a specific list of components added to them. This information is represented in a compile time bitset since every time a user attaches a component they call a template function that is what makes it possible to make these bit sets at compile time.</p> <p>Example physics system:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="nf">update</span><span class="p">()</span> <span class="k">override</span><span class="p">{</span>
    <span class="kt">float</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">DeltaTime</span><span class="p">();</span> <span class="c1">// provided by System_base</span>
    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">et</span> <span class="o">:</span> <span class="n">Entities</span><span class="p">){</span> <span class="c1">// contains all entities with required signature</span>
        <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">ComponentData</span><span class="p">.</span><span class="n">getComponentData</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Position</span><span class="o">&gt;</span><span class="p">(</span><span class="n">et</span><span class="p">);</span>
        <span class="k">auto</span><span class="o">&amp;</span> <span class="n">vel</span> <span class="o">=</span> <span class="n">ComponentData</span><span class="p">.</span><span class="n">getComponentData</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Velocity</span><span class="o">&gt;</span><span class="p">(</span><span class="n">et</span><span class="p">);</span>
        <span class="k">auto</span><span class="o">&amp;</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">ComponentData</span><span class="p">.</span><span class="n">getComponentData</span><span class="o">&lt;</span><span class="n">AGE_COMPONENTS</span><span class="o">::</span><span class="n">Acceleration</span><span class="o">&gt;</span><span class="p">(</span><span class="n">et</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">vel</span><span class="p">.</span><span class="n">v</span><span class="p">;</span>
        <span class="n">vel</span><span class="p">.</span><span class="n">v</span> <span class="o">+=</span> <span class="n">acc</span><span class="p">.</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
        <span class="n">pos</span><span class="p">.</span><span class="n">p</span> <span class="o">+=</span> <span class="p">(</span><span class="n">vel</span><span class="p">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>More on <a href="https://github.com/thaqibm/age" rel="external nofollow noopener" target="_blank">AGE Github</a></p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Thaqib M. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>